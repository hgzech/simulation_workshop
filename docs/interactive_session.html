---

title: Interactive session 


keywords: fastai
sidebar: home_sidebar



nb_path: "04_interactive_session.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 04_interactive_session.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Challenge-1:-Define-the-experiment.">Challenge 1: Define the experiment.<a class="anchor-link" href="#Challenge-1:-Define-the-experiment."> </a></h2><p>First we define how the experiment works.  Here, we will simulate a two-armed bandit experiment.  In the two-armed bandit task participants repeatedly choose between two stimuli. Each stimulus has a certain <b>reward probability</b>.  Participants complete several <b>trials</b> and their goal is to maximize <b>rewards</b>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-1:--Define-the-number-of-trials-and-reward-probabilities.">Step 1:  Define the number of trials and reward probabilities.<a class="anchor-link" href="#Step-1:--Define-the-number-of-trials-and-reward-probabilities."> </a></h3><p>First, we have to decide on the number of trials and the reward probabilities for each stimulus.  Store the number of trials in a variable <code>T</code> and store the reward probabilities (one for each of the two stimuli) in variable <code>mu</code>.
{% include note.html content='You can define these parameters however you want.  In the Collins paper there were 100 trials and the reward probabilities were .2 for one stimulus and .8 for the other.' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Enter your code here:</i></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Check the solution below:</i></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.2</span><span class="p">,</span> <span class="mf">.8</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-2:-Write-the-reward-function.">Step 2: Write the reward function.<a class="anchor-link" href="#Step-2:-Write-the-reward-function."> </a></h3><p>The reward function allocates reward stochastically based on reward probabilities. This function uses an action and the reward probabilities as inputs and returns either a reward of 1 or no reward (0).</p>
<p>It achieves this by generating a random number from a uniform distribution ranging from 0 and 1 (in Python you can do this using <code>np.random.random()</code>).</p>
<p>Next, it compares the reward probability associated with the chosen action <code>mu[action]</code> to that number.  If it is lower or equal <code>&lt;=</code> to the reward probability it returns 1 (reward) otherwise it returns 0 (no reward).</p>
<blockquote><p>Note, in python you implement functions by writing:```def allocate_reward(action, mu): # choice and mu are your inputs
    ...
    return reward # reward is your return value</p>

<pre><code>You implement if statements, by writing:```if ...:
    ...
else:
    ...</code></pre>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Enter your code here:</i></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Check the solution below:</i></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">allocate_reward</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">mu</span><span class="p">[</span><span class="n">action</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Challenge-2:-Set-up-your-first-behavioral-model-(Rescorla-Wagner).">Challenge 2: Set up your first behavioral model (Rescorla-Wagner).<a class="anchor-link" href="#Challenge-2:-Set-up-your-first-behavioral-model-(Rescorla-Wagner)."> </a></h2><p>The Rescorla-Wagner model consists of a softmax choice rule and a Q-learning update algorithm.  Initially, the model does not know which action is the best choice, so both actions should have the same Q-value.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-1:-Initialize-your-Q-values">Step 1: Initialize your Q-values<a class="anchor-link" href="#Step-1:-Initialize-your-Q-values"> </a></h3><p>In this step you define the initial Q-values. Store them in a variable <code>Q</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='We will need to run some calculations with these Q-values.  To allow for this you&#8217;ll have to place your Q-values into a numpy array <code>np.array([...,...])</code>.  The initial values should not matter much, but Collins et al. set them to .5.' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Enter your code here:</i></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Check the solution below:</i></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-2:-Implement-the-softmax-function.">Step 2: Implement the softmax function.<a class="anchor-link" href="#Step-2:-Implement-the-softmax-function."> </a></h3><p>The softmax function determines <b>choice probabilities</b> based on Q-values using the following formula:</p>
<p>$p_a = \dfrac{exp(Q_{at}*beta)} {\Sigma{exp(Q_{at}*beta)}}$</p>
<p>As you can see, this function also introduces our first participant parameter the<b> inverse temperature (beta)</b>.  The larger beta the more deterministic (less random) a person's choices are.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Bonus Question:What else does this function do, next to introducing beta?</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="2.2-Define-beta">2.2 Define beta<a class="anchor-link" href="#2.2-Define-beta"> </a></h4><p>First define beta and store it in the variable <code>beta</code>.  Here you can pick any positive value (we chose 4).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Bonus Question:Why does beta need to be positive?</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Enter your code here:</i></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Check the solution below:</i></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">beta</span> <span class="o">=</span> <span class="mi">4</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="2.3-Implement-the-softmax-function.">2.3 Implement the softmax function.<a class="anchor-link" href="#2.3-Implement-the-softmax-function."> </a></h4><blockquote><p>Note, remember in python you implement functions by writing:<code>def softmax(Q, beta): # Q and beta are your inputs
    ...
    return p # p is your return value</code></p>
<p>To exponentiate an array you use <code>np.exp()</code> and to calculate the sum of an array, you use <code>np.sum()</code>.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Enter your code here:</i></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Check the solution below:</i></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">softmax</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Q</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Q</span><span class="o">*</span><span class="n">beta</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">p</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-3:-Write-a-decision-function.">Step 3: Write a decision function.<a class="anchor-link" href="#Step-3:-Write-a-decision-function."> </a></h3><p>This function uses choice probabilities as an input and returns a concrete choice as an output.  It achieves this by first generating a random number from a uniform distribution ranging from 0 and 1 (in Python you can do this using <code>np.random.random()</code>).</p>
<p>Next, it compares the first choice probability to this number.  If it is lower or equal to the choice probability the chosen action is 0, else the chosen action is 1.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='Call this function <code>choose()</code>.  You will need an if statement.  Remember, in Python, you define this as:' %}<code>if ...:
    ...
else:
    ...</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Enter your code here:</i></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Check the solution below:</i></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">choose</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">random_number</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">random_number</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-4:-Write-the-update-function">Step 4: Write the update function<a class="anchor-link" href="#Step-4:-Write-the-update-function"> </a></h3><p>The update function updates Q-values based on the reward, according to this formula:
$Q_{a,t+1} = Q_{a,t} + \alpha (r - Q_{a,t})$</p>
<p>As you can see, this function introduces another participant parameter: the <b>learning rate (alpha)</b>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="4.1-Define-alpha">4.1 Define alpha<a class="anchor-link" href="#4.1-Define-alpha"> </a></h4><p>Pick a value between 0 and 1 (we chose .2) and store it as <code>alpha</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Enter your code here:</i></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Check the solution below:</i></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">.2</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="4.2:-Write-the-update-function">4.2: Write the update function<a class="anchor-link" href="#4.2:-Write-the-update-function"> </a></h4><p>Call this function <code>update_q_value()</code> with <code>Q</code>, <code>action</code>, <code>reward</code>, and <code>alpha</code> as inputs and <code>updated_q</code> and <code>delta</code> as outputs.  This function first calculates the prediction error and then updates Q.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Enter your code here:</i></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Check the solution below:</i></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">update_q</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">reward</span> <span class="o">-</span> <span class="n">Q</span><span class="p">[</span><span class="n">action</span><span class="p">]</span> <span class="c1"># prediction error</span>
    <span class="n">Q</span><span class="p">[</span><span class="n">action</span><span class="p">]</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="n">action</span><span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">delta</span>
    <span class="k">return</span> <span class="n">Q</span><span class="p">,</span> <span class="n">delta</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-5:-Putting-it-all-together">Step 5: Putting it all together<a class="anchor-link" href="#Step-5:-Putting-it-all-together"> </a></h3><p>Congratulations, you created all the components of your simulation function.  Now let's put them all together and simulate some data.  The simulation function (call it <a href="/simulation_workshop/simulation.html#simulate_M3RescorlaWagner_v1"><code>simulate_M3RescorlaWagner_v1</code></a>) takes the experiment parameters, <code>mu</code> and <code>T</code>, as well as the participant parameters <code>alpha</code> and <code>beta</code> as inputs.
{% include note.html content='Don&#8217;t forget to initialize the q-values as we did in step 2.1.' %}
In each trial, we simulate an action chosen by the participant, allocate a reward, and update the participant's q-values accordingly.
{% include note.html content='In Python you write loops like this:' %}<code>for t in range(T):
    ...</code></p>
<p>As outputs it returns the lists (i.e., vectors) <code>actions</code>, <code>rewards</code>, <code>Qs</code>, and <code>deltas</code> for each trial.
{% include note.html content='You create vectors like this <code>actions = []</code> and add data to a vector like this: <code>actions.append(action)</code>.' %}{% include warning.html content='For technical reasons, when you append Q to Qs, you have to append a copy of Q with <code>Qs.append(Q.copy())</code>' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Enter your code here:</i></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Check the solution below:</i></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">simulate_M3RescorlaWagner_v1</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="n">Qs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">deltas</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rewards</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span> 
        <span class="n">Qs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Q</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">softmax</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">choose</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">reward</span> <span class="o">=</span> <span class="n">allocate_reward</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">mu</span><span class="p">)</span>
        <span class="n">Q</span><span class="p">,</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">update_q</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="n">rewards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reward</span><span class="p">)</span>
        <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span> 
        <span class="n">deltas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">actions</span><span class="p">,</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">Qs</span><span class="p">,</span> <span class="n">deltas</span>
        
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Challenge-3:-Explore-the-parameters">Challenge 3: Explore the parameters<a class="anchor-link" href="#Challenge-3:-Explore-the-parameters"> </a></h2><p>We already wrote you a little function that simply uses your <a href="/simulation_workshop/simulation.html#simulate_M3RescorlaWagner_v1"><code>simulate_M3RescorlaWagner_v1</code></a> function to simulate an experiment based on your parameters and plots its outputs in a figure. Below, we will go through some parameter combinations and explore their effects.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_rescorla_game" class="doc_header"><code>plot_rescorla_game</code><a href="https://github.com/hgzech/simulation_workshop/tree/master/simulation_workshop/interactive_session.py#L13" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_rescorla_game</code>(<strong><code>T</code></strong>, <strong><code>mu</code></strong>, <strong><code>alpha</code></strong>, <strong><code>beta</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here are some example parameter values:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># number of trials</span>
<span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.2</span><span class="p">,</span><span class="mf">.8</span><span class="p">]</span> <span class="c1"># reward probabilities</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">.2</span> <span class="c1"># learning rate</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># inverse temperature</span>
<span class="n">plot_rescorla_game</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Reducing the learning rate (participant does not manage to learn probabilities)</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># number of trials</span>
<span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.2</span><span class="p">,</span><span class="mf">.8</span><span class="p">]</span> <span class="c1"># reward probabilities</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">.01</span> <span class="c1"># learning rate</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># inverse temperature</span>
<span class="n">plot_rescorla_game</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Let's give them more trials</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># number of trials</span>
<span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.2</span><span class="p">,</span><span class="mf">.8</span><span class="p">]</span> <span class="c1"># reward probabilities</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">.01</span> <span class="c1"># learning rate</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># inverse temperature</span>
<span class="n">plot_rescorla_game</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>An extreme beta value makes participants stop exploring.</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># number of trials</span>
<span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.2</span><span class="p">,</span><span class="mf">.8</span><span class="p">]</span> <span class="c1"># reward probabilities</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">.1</span> <span class="c1"># learning rate</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># inverse temperature</span>
<span class="n">plot_rescorla_game</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>If beta is very low, participants still learn, but they don't use that knowledge (something that we cannot see in this plot yet).</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># number of trials</span>
<span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.2</span><span class="p">,</span><span class="mf">.8</span><span class="p">]</span> <span class="c1"># reward probabilities</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">.1</span> <span class="c1"># learning rate</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mf">.0000000001</span> <span class="c1"># inverse temperature</span>
<span class="n">plot_rescorla_game</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Challenge-4:-Choice-Kernel">Challenge 4: Choice Kernel<a class="anchor-link" href="#Challenge-4:-Choice-Kernel"> </a></h2><p>The only difference between choice kernel and rescorla-wagner is that the softmax function takes choice_kernel values instead of Q-values as inputs and the update function is indendent of rewards.  Therefore, we only need to change the update function.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-1:-Write-a-new-update-function">Step 1: Write a new update function<a class="anchor-link" href="#Step-1:-Write-a-new-update-function"> </a></h3><p>The formula of the update function looks like this:</p>
<p>$CK_{a,t+1} = CK_{a,t} + \alpha * 1$</p>
<p>Before the choice kernel is updated, both choice kernels decay with the inverse of the learning rate:</p>
<p>$CK_{t+1} = CK_{t} * (1 - \alpha) $</p>
<p>Call this function <code>update_choice_kernels</code>, with the inputs <code>choice_kernel</code>, <code>action</code>, and <code>alpha</code>.
{% include note.html content='If you&#8217;re confused by the multiplication with one: This is only for comparability with the Rescorla-Wagner.' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Enter your code here:</i></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Check the solution below:</i></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">update_choice_kernels</span><span class="p">(</span><span class="n">choice_kernel</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
    <span class="n">choice_kernel</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">choice_kernel</span>
    <span class="n">choice_kernel</span><span class="p">[</span><span class="n">action</span><span class="p">]</span> <span class="o">=</span> <span class="n">choice_kernel</span><span class="p">[</span><span class="n">action</span><span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">choice_kernel</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-2:-Putting-it-all-together.">Step 2: Putting it all together.<a class="anchor-link" href="#Step-2:-Putting-it-all-together."> </a></h3><p>Now make a <a href="/simulation_workshop/interactive_session.html#simulate_M4ChoiceKernel_v1"><code>simulate_M4ChoiceKernel_v1</code></a> function similar to the rescorla wagner function but with our new update function and choice kernels instead of Qs.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Enter your code here:</i></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Check the solution below:</i></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="simulate_M4ChoiceKernel_v1" class="doc_header"><code>simulate_M4ChoiceKernel_v1</code><a href="https://github.com/hgzech/simulation_workshop/tree/master/simulation_workshop/interactive_session.py#L27" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>simulate_M4ChoiceKernel_v1</code>(<strong><code>T</code></strong>, <strong><code>mu</code></strong>, <strong><code>alpha</code></strong>, <strong><code>beta</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>Note that choice_kernel decays with the inverted alpha in each trial <code>choice_kernel = (1 - alpha_c) * choice_kernel</code></p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Challenge-5:-Explore-the-parameters-of-your-choice-kernel-simulations">Challenge 5: Explore the parameters of your choice kernel simulations<a class="anchor-link" href="#Challenge-5:-Explore-the-parameters-of-your-choice-kernel-simulations"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_choice_kernel_game" class="doc_header"><code>plot_choice_kernel_game</code><a href="https://github.com/hgzech/simulation_workshop/tree/master/simulation_workshop/interactive_session.py#L47" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_choice_kernel_game</code>(<strong><code>T</code></strong>, <strong><code>mu</code></strong>, <strong><code>alpha</code></strong>, <strong><code>beta</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># number of trials</span>
<span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.2</span><span class="p">,</span><span class="mf">.8</span><span class="p">]</span> <span class="c1"># reward probabilities</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">.2</span> <span class="c1"># learning rate</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># inverse temperature</span>
<span class="n">actions</span> <span class="o">=</span> <span class="n">plot_choice_kernel_game</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># number of trials</span>
<span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.2</span><span class="p">,</span><span class="mf">.8</span><span class="p">]</span> <span class="c1"># reward probabilities</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">.2</span> <span class="c1"># learning rate</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mf">.004</span> <span class="c1"># inverse temperature</span>
<span class="n">actions</span> <span class="o">=</span> <span class="n">plot_choice_kernel_game</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mi">500</span> <span class="c1"># number of trials</span>
<span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.2</span><span class="p">,</span><span class="mf">.8</span><span class="p">]</span> <span class="c1"># reward probabilities</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">.2</span> <span class="c1"># learning rate</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># inverse temperature</span>
<span class="n">actions</span> <span class="o">=</span> <span class="n">plot_choice_kernel_game</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>With a reasonably high beta one of the options should always move towards 1.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Reproducing-Collins'-figures">Reproducing Collins' figures<a class="anchor-link" href="#Reproducing-Collins'-figures"> </a></h1><p><img src="/simulation_workshop/images/wilson_figure.png" alt="alt text" title="Title"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Challenge-6:-Reproducing-Panel-A">Challenge 6: Reproducing Panel A<a class="anchor-link" href="#Challenge-6:-Reproducing-Panel-A"> </a></h2><p>Panel A shows the different in the probability of sticking to the same action (y-axis) depending on whether the last trial was a win or a loss (x-axis), split up by learning model (colors).  Here, we will only focus on the Rescorla-Wagner and the Choice Kernel model.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-1">Step 1<a class="anchor-link" href="#Step-1"> </a></h3><p>Write a fuction that first defines last_action and last_reward.  Then determines whether a trial was a stay or switch trial.  Finally it calculates the proportion of stay trials depending on whether the last trial was rewarded or not rewarded and outputs the score for each case.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>You can use <code>df.action.shift(1)</code> to create variables that represent the value of the last row.</p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">analysis_WSLS_v1</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="c1"># Shifting data back by one</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;last_action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;last_reward&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reward</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Deciding whether trial is stay trial</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;stay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="n">df</span><span class="o">.</span><span class="n">last_action</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="c1"># Calculating mean stay by case and outputing as series</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;last_reward&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">stay</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">loseStay</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">winStay</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">loseStay</span><span class="p">,</span> <span class="n">winStay</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">s</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-2">Step 2<a class="anchor-link" href="#Step-2"> </a></h3><p>Simulate data for 110 participants using the Rescorla-Wagner model and store their proportion of stay trials depending on the last trial's reward in a dataframe.  Finally, you calculate the mean proportion of stay trials (for wins and losses) over all participants (call the variable <code>rw</code>), which we will use in the plot.</p>
<p>For this, we will use the same experiment and participant parameters as Collins, below:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mi">100</span> 
<span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.2</span><span class="p">,</span><span class="mf">.8</span><span class="p">]</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">.1</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">participants</span> <span class="o">=</span> <span class="mi">110</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='To turn the actions and rewards into a dataframe, you can use <code>df = pd.DataFrame({&amp;#8217;action&amp;#8217;:actions, &amp;#8217;reward&amp;#8217;:rewards})</code>.' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Enter your code here:</i></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Check the solution below:</i></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">participants</span><span class="p">):</span>
    <span class="n">actions</span><span class="p">,</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">Cks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">simulate_M3RescorlaWagner_v1</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;action&#39;</span><span class="p">:</span><span class="n">actions</span><span class="p">,</span> <span class="s1">&#39;reward&#39;</span><span class="p">:</span><span class="n">rewards</span><span class="p">})</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">analysis_WSLS_v1</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;loseStay&#39;</span><span class="p">,</span><span class="s1">&#39;winStay&#39;</span><span class="p">]</span>
<span class="n">rw</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rw</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To see if this worked, let's plot the result.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-3">Step 3<a class="anchor-link" href="#Step-3"> </a></h3><p>Now do the same for the choice kernel and call the variable <code>ck</code>.  Note that for this, Collins changed beta to 3.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Enter your code here:</i></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Check the solution below:</i></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">beta</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># inverse temperature</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">participants</span><span class="p">):</span>
    <span class="n">actions</span><span class="p">,</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">Cks</span> <span class="o">=</span> <span class="n">simulate_M4ChoiceKernel_v1</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;action&#39;</span><span class="p">:</span><span class="n">actions</span><span class="p">,</span> <span class="s1">&#39;reward&#39;</span><span class="p">:</span><span class="n">rewards</span><span class="p">})</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">analysis_WSLS_v1</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;loseStay&#39;</span><span class="p">,</span><span class="s1">&#39;winStay&#39;</span><span class="p">]</span>
<span class="n">ck</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-4">Step 4<a class="anchor-link" href="#Step-4"> </a></h3><p>We plot everything together.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">rw</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">ck</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Challenge-7:-Reproducing-Panel-B">Challenge 7: Reproducing Panel B<a class="anchor-link" href="#Challenge-7:-Reproducing-Panel-B"> </a></h2><p>To create Panel B, we simulate the proportion of correct choices (y-axis) split by different values of alpha (x-axis) and beta (colors), split by early (first ten) and late (last ten) trials (subpanels).  These are the alphas and betas that Collins uses for this plot:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">alphas</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">.02</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">.02</span><span class="p">))</span>
<span class="n">betas</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-1">Step 1<a class="anchor-link" href="#Step-1"> </a></h3><p>Write a nested loop that loops through 200 simulations, all alphas, and all betas.  In each iteration it simulates data using the Rescorla-Wagner model and outputs the proportion of correct choices (a choice is correct when the stimulus that is more likely to return a reward is picked) in the first and last ten trials.
{% include note.html content='To store the output first make a <code>data</code> list and in each iteration make a <code>session</code> dictionary which you append to the data list.' %}{% include note.html content='To get the correct action (i.e. the action associated with the highest reward probability, us <code>np.argmax(mu)</code>.' %}{% include note.html content='Collins runs 1000 simulations, but because our code runs a bit slow, we recommend doing this 200 per alpha beta combination.' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Enter your code here:</i></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Check the solution below:</i></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">beta</span> <span class="ow">in</span> <span class="n">betas</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">simulate_M3RescorlaWagner_v1</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
            <span class="n">session_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">session_dict</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span>
            <span class="n">session_dict</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta</span>
            
            <span class="n">imax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="c1"># Mu max index</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">session_dict</span><span class="p">[</span><span class="s1">&#39;correct_early&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">==</span> <span class="n">imax</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">session_dict</span><span class="p">[</span><span class="s1">&#39;correct_late&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span> <span class="o">==</span> <span class="n">imax</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">session_dict</span><span class="p">)</span>
            
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/simulation_workshop/images/wilson_figure.png" alt="alt text" title="Title"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-2">Step 2<a class="anchor-link" href="#Step-2"> </a></h3><p>Let's plot this all together.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='You can use <code>fig, axs = plt.subplots(1,2, figsize = (14,7))</code> to make a figure with several plots in it; you can use <code>sns.lineplot</code> to make nice lineplots; this also lets you chose the color palette (we already chose <code>sns.color_palette("rocket_r")[:5]</code>).' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Enter your code here:</i></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Check the solution below:</i></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;rocket_r&quot;</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;correct_early&#39;</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="n">ci</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">palette</span><span class="p">)</span>
<span class="c1">#</span>

<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;correct_late&#39;</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="n">ci</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">palette</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;early trials&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;late trials&quot;</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Well-done!-:)">Well done! :)<a class="anchor-link" href="#Well-done!-:)"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Bonus-Challenge:-Combine-all-plots-to-make-them-look-exactly-as-Collins'.">Bonus Challenge: Combine all plots to make them look exactly as Collins'.<a class="anchor-link" href="#Bonus-Challenge:-Combine-all-plots-to-make-them-look-exactly-as-Collins'."> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Enter your code here:</i></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><i>Check the solution below:</i></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

